# Operating System

---

## 概念

- 负责管理协调硬件、软件等计算机资源的工作
- 为上层用户、应用程序提供简单易用的服务
- 是一种**系统软件**

## 功能和目标

三种角色：**资源的管理者**、**用户服务的提供者**、**硬件机器的扩展**

### 资源的管理者

- **处理机管理**
- **存储器管理**
- **文件管理**
- **IO设备管理**

### 向用户提供服务

- 命令接口
  - 联机命令接口
  - 脱机命令接口
- 程序接口
  - 由一组系统调用组成
- GUI用户图形界面

### 对硬件及其的扩展

- 扩充机器

## 操作系统特性

### 并发

### 共享

- 互斥共享方式 --> 如对摄像头设备的共享使用
- 同时共享方式 --> 如对硬盘资源的共享使用

### 虚拟

- 空分复用技术 --> 如虚拟存储技术
- 时分复用技术 --> 如虚拟存储器技术

### 异步

**并发与共享互为存在条件**

**没有并发与共享，就不存在虚拟与异步。因此，并发与共享是操作系统的两个最基本的特征**

## OS的发展与分类

### 手工操作阶段

- 缺点：人机速度矛盾

### 批处理阶段

#### 单道批处理系统

引入脱机输入/输出技术

- 优点：缓解人机速度矛盾
- 缺点：资源利用率仍然低

#### 多道批处理系统

操作系统开始出现

- 优点：多道程序并发执行，资源利用率高
- 缺点：不提供人机交互

### 分时操作系统

- 优点：提供人机交互
- 缺点： 不能优先处理紧急的任务

### 实时操作系统

- 优点：能优先处理紧急任务

#### 硬实时系统

必须在绝对严格的规定时间内完成处理

#### 软实时系统

能偶尔接受违反时间规定

### 网络操作系统

### 分布式操作系统

## 操作系统运行机制与体系结构

### 运行机制

- **指令**
  - 特权指令
  - 非特权指令
- **处理器状态**
  - 核心态
  - 用户态
- **程序**
  - 内核程序
  - 应用程序

### 操作系统内核

- **时钟管理**
  - 实现计时功能
- **中断管理**
  - 负责实现中断机制
- **原语**
  - 一种特殊的程序
  - 处于操作系统的最底层，是最接近硬件的部分
  - 这种程序的运行具有**原子性**
  - 运行时间较短、调用较频繁
- **对系统资源进行管理** --> 大内核与微内核
  - 进程管理
  - 内存管理
  - IO设备管理

### 体系结构

- **大内核**
  - 优点：性能高
  - 缺点：内核代码庞大，结构混乱，难以维护
- **微内核**
  - 优点：内核功能少，结构清晰，方便维护
  - 缺点：需要频繁地在用户态与内核态之间切换，性能低

## 中断和异常

### 中断机制的产生

- 为实现多道程序并发执行而引入的一种技术

### 中断的概念

- 发生中断，就意味着操作系统需要介入并开展管理调配工作，CPU会进入**核心态**
- **中断是CPU从用户态进入内核态的唯一途径**

### 中断的分类

- **内中断**(也称为异常、例外、陷入)
  - 自愿中断 -- 指令中断
  - 强迫中断
    - 硬件故障
    - 软件中断
- **外中断**
  - 外设请求
  - 人工干预

### 外中断的处理过程

- 每条指令执行结束后，CPU检查是否有外部中断信号
- 若有中断信号，则需要保护被中断进程的CPU环境
- 根据中断信号类型转入相应的中断处理程序
- 恢复原程序的CPU环境并退出中断，返回原进程继续往下执行

## 系统调用

### 系统调用概念

- 操作系统提供给应用程序使用的接口
- 应用程序通过系统调用来请求获得操作系统的服务
- 系统调用会使处理器从用户态进入内核态(使用陷入(trap)产生中断)
- 系统调用分类
  - 设备管理
  - 文件管理
  - 进程控制
  - 进程通信
  - 内存管理

### 系统调用和库函数

- 系统调用是操作系统向上层提供的接口
- 有的库函数是对系统调用的进一步封装
- 应用程序大多是通过高级语言提供的库函数间接地进行系统调用

### 系统调用流程

- 传递系统调用参数
- 执行陷入指令
- 执行系统调用相应服务程序
- 返回用户程序

